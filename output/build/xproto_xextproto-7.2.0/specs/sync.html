<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>X Synchronization Extension Protocol</title><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /></head><body><div class="book" title="X Synchronization Extension Protocol"><div class="titlepage"><div><div><h1 class="title"><a id="sync"></a>X Synchronization Extension Protocol</h1></div><div><h2 class="subtitle">X Consortium Standard</h2></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Tim</span> <span class="surname">Glauert</span></h3><div class="affiliation"><span class="orgname">Olivetti Research/MultiWorks<br /></span></div></div><div class="othercredit"><h3 class="othercredit"><span class="firstname">Dave</span> <span class="surname">Carver</span></h3><div class="affiliation"><span class="orgname">Digital Equipment Corporation, MIT/Project Athena<br /></span></div></div><div class="othercredit"><h3 class="othercredit"><span class="firstname">Jim</span> <span class="surname">Gettys</span></h3><div class="affiliation"><span class="orgname">Digital Equipment Corporation, Cambridge Research Laboratory<br /></span></div></div><div class="othercredit"><h3 class="othercredit"><span class="firstname">David</span> <span class="surname">Wiggins</span></h3><div class="affiliation"><span class="orgname">X Consortium, Inc.<br /></span></div></div><div class="othercredit"><h3 class="othercredit"><span class="firstname">James</span> <span class="surname">Jones</span></h3><div class="affiliation"><span class="orgname">NVIDIA Corporation<br /></span></div></div></div></div><div><p class="releaseinfo">X Version 11, Release 6.6.84</p></div><div><p class="releaseinfo">Version 3.1</p></div><div><p class="copyright">Copyright © 1991 
Olivetti Research Limited, Cambridge England and
Digital Equipment Corporation, Maynard, Massachusetts
       </p></div><div><p class="copyright">Copyright © 1991 X Consortium</p></div><div><p class="copyright">Copyright © 2010 NVIDIA Corporation</p></div><div><div class="legalnotice" title="Legal Notice"><a id="idp16780856"></a><p>
Permission to use, copy, modify, and distribute this documentation for any
purpose and without fee is hereby granted, provided that the above
copyright notice appear in all copies. Olivetti, Digital, MIT, the
X Consortium, and NVIDIA make no representations about the suitability for
any purpose of the information in this document. This documentation is
provided as is without express or implied warranty.
</p><p>
Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files
(the "Software"), to deal in the Software without
restriction, including without limitation the rights to use, copy,
modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished
to do so, subject to the following conditions:
</p><p>The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.</p><p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY
KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO
EVENT SHALL THE X CONSORTIUM BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.</p><p>Except as contained in this notice, the name of the X Consortium shall
not be used in advertising or otherwise to promote the sale, use or other
dealings in this Software without prior written authorization from the X
Consortium.</p></div></div></div><hr /></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="chapter"><a href="#synchronization_protocol">1. Synchronization Protocol</a></span></dt><dd><dl><dt><span class="sect1"><a href="#description">Description</a></span></dt><dt><span class="sect1"><a href="#types">Types</a></span></dt><dt><span class="sect1"><a href="#errors">Errors</a></span></dt><dt><span class="sect1"><a href="#requests">Requests</a></span></dt><dt><span class="sect1"><a href="#events">Events</a></span></dt></dl></dd><dt><span class="chapter"><a href="#encoding">2. Encoding</a></span></dt><dd><dl><dt><span class="sect1"><a href="#encoding_new_types">Encoding New Types</a></span></dt><dt><span class="sect1"><a href="#encoding_errors">Encoding Errors</a></span></dt><dt><span class="sect1"><a href="#encoding_requests">Encoding Requests</a></span></dt><dt><span class="sect1"><a href="#encoding_events">Encoding Events</a></span></dt></dl></dd></dl></div><div class="chapter" title="Chapter 1. Synchronization Protocol"><div class="titlepage"><div><div><h2 class="title"><a id="synchronization_protocol"></a>Chapter 1. Synchronization Protocol</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="#description">Description</a></span></dt><dt><span class="sect1"><a href="#types">Types</a></span></dt><dt><span class="sect1"><a href="#errors">Errors</a></span></dt><dt><span class="sect1"><a href="#requests">Requests</a></span></dt><dt><span class="sect1"><a href="#events">Events</a></span></dt></dl></div><p>
The core X protocol makes no guarantees about the relative order of execution
of requests for different clients. This means that any synchronization between
clients must be done at the client level in an operating system-dependent and
network-dependent manner. Even if there was an accepted standard for such
synchronization, the use of a network introduces unpredictable delays between
the synchronization of the clients and the delivery of the resulting requests
to the X server.
</p><p>
The core X protocol also makes no guarantees about the time at which requests
are executed, which means that all clients with real-time constraints must
implement their timing on the host computer. Any such timings are subject to
error introduced by delays within the operating system and network and are
inefficient because of the need for round-trip requests that keep the client
and server synchronized.
</p><p>
The synchronization extension provides primitives that allow synchronization
between clients to take place entirely within the X server. This removes any
error introduced by the network and makes it possible to synchronize clients
on different hosts running different operating systems. This is important for
multimedia applications, where audio, video, and graphics data streams are
being synchronized.  The extension also provides internal timers within the
X server to which client requests can be synchronized. This allows simple
animation applications to be implemented without any round-trip requests and
makes best use of buffering within the client, network, and server.
</p><div class="sect1" title="Description"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="description"></a>Description</h2></div></div></div><p>
The mechanism used by this extension for synchronization within the X
server is to block the processing of requests from a client until a
specific synchronization condition occurs. When the condition occurs, the
client is released and processing of requests continues. Multiple clients
may block on the same condition to give inter-client synchronization.
Alternatively, a single client may block on a condition such as an animation
frame marker.
</p><p>
The extension adds <code class="function">Counter</code>, <code class="function">Alarm</code>,
and <code class="function">Fence</code> to the set of resources managed by the
server. A counter has a 64-bit integer value that may be increased or
decreased by client requests or by the server internally. A client can block
by sending an Await request that waits until one of a set of synchronization
conditions, called TRIGGERs, becomes TRUE.  Alarms generate events when
counter values go through a specified transition.  A fence has two possible
states: triggered and not triggered. Client requests can put the fence in
either of these states. A client can block until one of a set of fences
becomes triggered by sending an AwaitFence request.  Fences are bound to a
particular screen at creation time.
</p><p>
The <code class="function">CreateCounter</code> request allows a client to create a
<code class="function">Counter</code> that can be changed by explicit
<code class="function">SetCounter</code> and <code class="function">ChangeCounter</code>
requests. These can be used to implement synchronization between different
clients.
</p><p>
There are some counters, called <code class="function">System Counters</code>, that
are changed by the server internally rather than by client requests. The
effect of any change to a system counter is not visible until the server
has finished processing the current request. In other words, system
counters are apparently updated in the gaps between the execution of
requests rather than during the actual execution of a request. The extension
provides a system counter that advances with the server time as defined by
the core protocol, and it may also provide counters that advance with the
real-world time or that change each time the CRT screen is refreshed.
Other extensions may provide their own extension-specific system counters.
</p><p>
The extension provides an <code class="function">Alarm</code> mechanism that allows
clients to receive an event on a regular basis when a particular counter
is changed.
</p><p>
The <code class="function">CreateFence</code> request allows a client to create a
<code class="function">Fence</code> that can be triggered and reset using
<code class="function">TriggerFence</code> and <code class="function">ResetFence</code>
requests, respectively.  <code class="function">CreateFence</code> takes a drawable
argument that implies which screen the fence should be created on.  The
<code class="function">TriggerFence</code> request changes the fence's state only
after all previous rendering commands affecting objects owned by the given
fence's screen have completed.  Note that while fence objects are bound
to a screen and the simple trigger operation provided by this extension
operates at screen granularity, other extensions may add more fine-grained
trigger operations based on any number of events.  The screen binding
merely establishes an upper bound for the scope of fence operations.
</p></div><div class="sect1" title="Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="types"></a>Types</h2></div></div></div><p>
Please refer to the X11 Protocol specification as this document uses
syntactic conventions established there and references types defined there.
</p><p>The following new types are used by the extension.</p><pre class="literallayout">
INT64:                 64-bit signed integer
COUNTER:               XID
VALUETYPE:             {Absolute,Relative};
TESTTYPE:              {PositiveTransition,NegativeTransition,
                        PositiveComparison,NegativeComparison}
TRIGGER:               [
                        counter:COUNTER,
                        value-type:VALUETYPE,
                        wait-value:INT64,
                        test-type:TESTTYPE
                       ]
WAITCONDITION:         [
                        trigger:TRIGGER,
                        event-threshold:INT64
                       ]
SYSTEMCOUNTER:         [
                        name:STRING8,
                        counter:COUNTER,
                        resolution:INT64
                       ]
ALARM:                 XID
ALARMSTATE:            {Active,Inactive,Destroyed}
FENCE:                 XID
</pre><p>
The COUNTER type defines the client-side handle on a server
<code class="function">Counter</code>. The value of a counter is an INT64.
</p><p>
The TRIGGER type defines a test on a counter that is either TRUE or FALSE. The
value of the test is determined by the combination of a test value, the value
of the counter, and the specified test-type.
</p><p>
The test value for a trigger is calculated using the value-type and
wait-value fields when the trigger is initialized. If the value-type field
is not one of the named VALUETYPE constants, the request that initialized the
trigger will return a <code class="function">Value</code> error. If the value-type
field is <code class="function">Absolute</code>, the test value is given by the
wait-value field. If the value-type field is <code class="function">Relative</code>,
the test value is obtained by adding the wait-value field to the value of the
counter. If the resulting test value would lie outside the range for an
INT64, the request that initialized the trigger will return a
<code class="function">Value</code> error. If counter is <code class="function">None</code>
and the value-type is <code class="function">Relative</code>, the request that
initialized the trigger will return a <code class="function">Match</code> error. If
counter is not None and does not name a valid counter, a Counter error is
generated.
</p><p>
If the test-type is <code class="function">PositiveTransition</code>, the trigger is
initialized to FALSE, and it will become TRUE when the counter changes from
a value less than the test value to a value greater than or equal to the
test value. If the test-type is <code class="function">NegativeTransition</code>,
the trigger is initialize to FALSE, and it will become TRUE when the counter
changes from a value greater than the test value to a value less than or
equal to the test value. If the test-type is
<code class="function">PositiveComparison</code>, the trigger is TRUE if the
counter is greater than or equal to the test value and FALSE otherwise. If the
test-type is <code class="function">NegativeComparison</code>, the trigger is TRUE
if the counter is less than or equal to the test value and FALSE otherwise.
If the test-type is not one of the named TESTTYPE constants, the request that
initialized the trigger will return a Value error. A trigger with a counter
value of <code class="function">None</code> and a valid test-type is always TRUE.
</p><p>
The WAITCONDITION type is simply a trigger with an associated event-threshold.
The event threshold is used by the <code class="function">Await</code> request to
decide whether or not to generate an event to the client after the trigger has
become TRUE. By setting the event-threshold to an appropriate value, it is
possible to detect the situation where an <code class="function">Await</code> request
was processed after the TRIGGER became TRUE, which usually indicates that
the server is not processing requests as fast as the client expects.
</p><p>
The SYSTEMCOUNTER type provides the client with information about a
<code class="function">System</code>Counter. The name field is the textual name of
the counter that identifies the counter to the client. The counter field
is the client-side handle that should be used in requests that require a
counter. The resolution field gives the approximate step size of the system
counter. This is a hint to the client
that the extension may not be able to resolve two wait conditions with test
values that differ by less than this step size. A microsecond clock, for
example, may advance in steps of 64 microseconds, so a counter based on this
clock would have a resolution of 64.
</p><p>
The only system counter that is guaranteed to be present is called SERVERTIME,
which counts milliseconds from some arbitrary starting point. The least
significant 32 bits of this counter track the value of Time used by the
server in Events and Requests. Other system counters may be provided by
different implementations of the extension. The X Consortium will maintain a
registry of system counter names to avoid collisions in the name space.
</p><p>
An ALARM is the client-side handle on an <code class="function">Alarm</code> resource.
</p><p>
The FENCE type defines the client-side handle on a server
<code class="function">Fence</code>.  A fence can only be in one of two states,
represented by a BOOL.  If the value is TRUE, the fence is in the triggered
state.  Otherwise, the fence is in the not triggered state.
</p></div><div class="sect1" title="Errors"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="errors"></a>Errors</h2></div></div></div><div class="variablelist"><dl><dt><span class="term">Counter</span></dt><dd><p>
This error is generated if the value for a COUNTER argument in a request
does not name a defined COUNTER.
      </p></dd><dt><span class="term">Alarm</span></dt><dd><p>
This error is generated if the value for an ALARM argument in a request
does not name a defined ALARM.
      </p></dd><dt><span class="term">Fence</span></dt><dd><p>
This error is generated if the value for a FENCE argument in a request
does not name a defined FENCE.
      </p></dd></dl></div></div><div class="sect1" title="Requests"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="requests"></a>Requests</h2></div></div></div><div class="variablelist"><dl><dt><span class="term">Initialize</span></dt><dd><pre class="literallayout">
version-major,version-minor: CARD8
=&gt;
version-major,version-minor: CARD8
</pre><p>
This request must be executed before any other requests for this extension. If a
client violates this rule, the results of all SYNC requests that it issues are
undefined. The request takes the version number of the extension that the
client wishes to use and returns the actual version number being implemented
by the extension for this client. The extension may return different
version numbers to a client depending of the version number supplied by
that client. This request should be executed only once for each client
connection.
     </p><p>
Given two different versions of the SYNC protocol, v1 and v2, v1 is
compatible with v2 if and only if v1.version_major = v2.version_major
and v1.version_minor &lt;= v2.version_minor.  Compatible means that the
functionality is fully supported in an identical fashion in the two versions.
     </p><p>
This document describes major version 3, minor version 1 of the SYNC protocol.
     </p></dd><dt><span class="term">ListSystemCounters</span></dt><dd><pre class="literallayout">
=&gt;
system-counters: LISTofSYSTEMCOUNTER
Errors: Alloc
</pre><p>
This request returns a list of all the system counters that are available at
the time the request is executed, which includes the system counters
that are maintained by other extensions. The list returned by this
request may change as counters are created and destroyed by other extensions.
      </p></dd><dt><span class="term">CreateCounter</span></dt><dd><pre class="literallayout">
id: COUNTER
initial-value: INT64
Errors: IDChoice,Alloc
</pre><p>
This request creates a counter and assigns the specified id to it. The counter
value is initialized to the specified initial-value and there are no clients
waiting on the counter.
      </p></dd><dt><span class="term">DestroyCounter</span></dt><dd><pre class="literallayout">
counter: COUNTER
Errors: Counter,Access
</pre><p>
This request destroys the given counter and sets the counter fields for all
triggers that specify this counter to <code class="function">None</code>. All clients
waiting on the counter are released and a <code class="function">CounterNotify</code>
event with the destroyed field set to TRUE is sent to each waiting client,
regardless of the event-threshold. All alarms specifying the counter become
<code class="function">Inactive</code> and an <code class="function">AlarmNotify</code>
event with a state field of <code class="function">Inactive</code> is generated. A
counter is destroyed automatically when the connection to the creating client
is closed down if the close-down mode is Destroy. An
<code class="function">Access</code> error is generated if counter is a system
counter. A <code class="function">Counter</code> error is generated if counter does
not name a valid counter.
      </p></dd><dt><span class="term">QueryCounter</span></dt><dd><pre class="literallayout">
counter: COUNTER
=&gt;
value: INT64
Errors: <code class="function">Counter</code>
</pre><p>
This request returns the current value of the given counter or a generates
Counter error if counter does not name a valid counter.
      </p></dd><dt><span class="term">Await</span></dt><dd><pre class="literallayout">
wait-list: LISTofWAITCONDITION
Errors: Counter,Alloc,Value
</pre><p>
When this request is executed, the triggers in the wait-list are initialized
using the wait-value and value-type fields, as described in the definition of
TRIGGER above. The processing of further requests for the client is blocked
until one or more of the triggers becomes TRUE. This may happen immediately,
as a result of the initialization, or at some later time, as a result of
a subsequent <code class="function">SetCounter</code>,
<code class="function">ChangeCounter</code> or
<code class="function">DestroyCounter</code> request.
      </p><p>
A Value error is generated if wait-list is empty.
      </p><p>
When the client becomes unblocked, each trigger is checked to determine
whether a <code class="function">CounterNotify</code> event should be generated.
The difference between the counter and the test value is calculated by
subtracting the test value from the value of the counter. If the test-type
is <code class="function">PositiveTransition</code> or
<code class="function">PositiveComparison</code>, a
<code class="function">CounterNotify</code> event is generated if the difference is
at least event-threshold. If the test-type is
<code class="function">NegativeTransition</code> or
<code class="function">NegativeComparison</code>, a
<code class="function">CounterNotify</code> event is generated if the difference
is at most event-threshold. If the difference lies outside the range for an
INT64, an event is not generated.
      </p><p>
This threshold check is made for each trigger in the list and a
<code class="function">CounterNotify</code> event is generated for every trigger for
which the check succeeds. The check for
<code class="function">CounterNotify</code> events is performed even if one of the
triggers is TRUE when the request is first executed. Note that a
<code class="function">CounterNotify</code> event may be generated for a trigger
that is FALSE if there are multiple triggers in the request. A
<code class="function">CounterNotify</code> event with the destroyed flag set to
TRUE is always generated if the counter for one of the triggers is
destroyed.
      </p></dd><dt><span class="term">ChangeCounter</span></dt><dd><pre class="literallayout">
counter: COUNTER
amount: INT64
Errors: <code class="function">Counter,Access,Value</code>
</pre><p>
This request changes the given counter by adding amount to the current
counter value. If the change to this counter satisfies a trigger for which a client
is waiting, that client is unblocked and one or more
<code class="function">CounterNotify</code> events may be generated. If the change to
the counter satisfies the trigger for an alarm, an
<code class="function">AlarmNotify</code> event is generated and the
alarm is updated. An <code class="function">Access</code> error is generated if
counter is a system counter. A <code class="function">Counter</code> error is
generated if counter does not name a valid counter. If the resulting value
for the counter would be outside the range for an INT64, a
<code class="function">Value</code> error is generated and the counter is not changed.
      </p><p>
It should be noted that all the clients whose triggers are satisfied by this
change are unblocked, so this request cannot be used to implement mutual
exclusion.
      </p></dd><dt><span class="term">SetCounter</span></dt><dd><pre class="literallayout">
counter: COUNTER
value: INT64
Errors: <code class="function">Counter,Access</code>
</pre><p>
This request sets the value of the given counter to value. The effect is
equivalent to executing the appropriate ChangeCounter request to change
the counter value to value. An Access error is generated if counter names a
system counter. A Counter error is generated if counter does not name a valid
counter.
      </p></dd><dt><span class="term">CreateAlarm</span></dt><dd><pre class="literallayout">
id: ALARM
values-mask: CARD32
values-list: LISTofVALUE
left"&gt;Errors: IDChoice,Counter,Match,Value,Alloc
</pre><p>
This request creates an alarm and assigns the identifier id to it. The
values-mask and values-list specify the attributes that are to be explicitly
initialized. The attributes for an Alarm and their defaults are:
      </p><div class="informaltable"><table border="1"><colgroup><col class="c1" /><col class="c2" /><col class="c3" /><col class="c4" /></colgroup><tbody><tr><td align="left">Attribute</td><td align="left">Type</td><td align="left">Default</td><td class="auto-generated"> </td></tr><tr><td> </td><td> </td><td> </td><td> </td></tr><tr><td align="left">trigger</td><td align="left">TRIGGER</td><td align="left">counter</td><td align="left">None</td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left">value-type</td><td align="left">Absolute</td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left">value</td><td align="left">0</td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left">test-type</td><td align="left">PositiveComparison</td></tr><tr><td align="left">delta</td><td align="left">INT64</td><td align="left">1</td><td class="auto-generated"> </td></tr><tr><td align="left">events</td><td align="left">BOOL</td><td align="left">TRUE</td><td class="auto-generated"> </td></tr></tbody></table></div><p>
The trigger is initialized as described in the definition of TRIGGER, with an
error being generated if necessary.
      </p><p>
If the counter is <code class="function">None</code>, the state of the alarm is set
to <code class="function">Inactive</code>, else it is set to Active.
      </p><p>
Whenever the trigger becomes TRUE, either as a result of this request or as the
result of a <code class="function">SetCounter</code>,
<code class="function">ChangeCounter</code>, <code class="function">DestroyCounter</code>, or
<code class="function">ChangeAlarm</code> request, an
<code class="function">AlarmNotify</code> event is generated and the alarm is
updated. The alarm is updated by repeatedly adding delta to the value of the
trigger and reinitializing it until it becomes FALSE. If this update would
cause value to fall outside the range for an INT64, or if the counter
value is <code class="function">None</code>, or if the delta is 0 and test-type
is <code class="function">PositiveComparison</code> or
<code class="function">NegativeComparison</code>, no change is made to value and
the alarm state is changed to <code class="function">Inactive</code> before the
event is generated. No further events are generated by an
<code class="function">Inactive</code> alarm until a <code class="function">ChangeAlarm</code>
or <code class="function">DestroyAlarm </code> request is executed.
      </p><p>
If the test-type is <code class="function">PositiveComparison</code> or
<code class="function">PositiveTransition and</code> delta is less than zero, or
if the test-type is <code class="function">NegativeComparison</code> or
<code class="function">NegativeTransition</code> and delta is greater than zero,
a <code class="function">Match</code> error is generated.
      </p><p>
The events value enables or disables delivery of
<code class="function">AlarmNotify</code> events
to the requesting client. The alarm keeps a separate event flag for
each client so that other clients may select to receive events from this
alarm.
      </p><p>
An <code class="function">AlarmNotify</code> event is always generated at some time
after the execution of a <code class="function">CreateAlarm</code> request. This
will happen immediately if the trigger is TRUE, or it will happen later
when the trigger becomes TRUE or the Alarm is destroyed.
      </p></dd><dt><span class="term">ChangeAlarm</span></dt><dd><pre class="literallayout">
id: ALARM
values-mask: CARD32
values-list: LISTofVALUE
Errors: Alarm,Counter,Value,Match
</pre><p>
This request changes the parameters of an Alarm. All of the parameters
specified for the <code class="function">CreateAlarm</code> request may be changed
using this request.  The trigger is reinitialized and an
<code class="function">AlarmNotify</code> event is generated if appropriate, as
explained in the description of the <code class="function">CreateAlarm</code> request.
      </p><p>
Changes to the events flag affect the event delivery to the requesting
client only and may be used by a client to select or deselect event delivery
from an alarm created by another client.
      </p><p>
The order in which attributes are verified and altered is server-dependent.
If an error is generated, a subset of the attributes may have been altered.
      </p></dd><dt><span class="term">DestroyAlarm</span></dt><dd><pre class="literallayout">
alarm: ALARM
Errors: Alarm
</pre><p>
This request destroys an alarm. An alarm is automatically destroyed when the
creating client is closed down if the close-down mode is
<code class="function">Destroy</code>. When an alarm is destroyed, an
<code class="function">AlarmNotify</code> event is generated with a state value of
<code class="function">Destroyed</code>.
      </p></dd><dt><span class="term">QueryAlarm</span></dt><dd><pre class="literallayout">
alarm: ALARM
=&gt;
trigger: TRIGGER
delta: INT64
events: ALARMEVENTMASK
state: ALARMSTATE
Errors: <code class="function">Alarm</code>
</pre><p>This request retrieves the current parameters for an Alarm.</p></dd><dt><span class="term">SetPriority</span></dt><dd><pre class="literallayout">
client-resource: XID
priority: INT32
Errors: <code class="function">Match</code>
</pre><p>
This request changes the scheduling priority of the client that created
client-resource. If client-resource is <code class="function">None</code>, then
the priority for the client making the request is changed. A
<code class="function">Match</code> error is generated if client-resource is not
<code class="function">None</code> and does not name an existing resource in the
server. For any two priority values, A and B, A is higher priority if
and only if A is greater than B.
      </p><p>
The priority of a client is set to 0 when the initial client connection is
 made.
      </p><p>
The effect of different client priorities depends on the particular
implementation of the extension, and in some cases it may have no effect at
all. However, the intention is that higher priority clients will have
their requests executed before those of lower priority clients.
      </p><p>
For most animation applications, it is desirable that animation clients be
given priority over nonrealtime clients. This improves the smoothness of the
animation on a loaded server. Because a server is free to implement very strict
priorities, processing requests for the highest priority client to the
exclusion of all others, it is important that a client that may potentially
monopolize the whole server, such as an animation that produces continuous
output as fast as it can with no rate control, is run at low rather than high
priority.
      </p></dd><dt><span class="term">GetPriority</span></dt><dd><pre class="literallayout">
client-resource: XID
=&gt;
priority: INT32
Errors: <code class="function">Match</code>
</pre><p>
This request returns the scheduling priority of the client that created
client-resource. If client-resource is <code class="function">None</code>, then the
priority for the client making the request is returned. A
<code class="function">Match</code> error is generated if client-resource is
not <code class="function">None</code> and does not name an existing resource in the
server.
      </p></dd><dt><span class="term">CreateFence</span></dt><dd><pre class="literallayout">
drawable: DRAWABLE
id: FENCE
initially-triggered: BOOL
Errors: <code class="function">IDChoice</code>,<code class="function">Alloc</code>
</pre><p>
This request creates a fence on the screen associated with drawable and
assigns the specified id to it. The fence is in the triggered state iff
initially-triggered is TRUE. There are no clients waiting on the fence.
      </p></dd><dt><span class="term">TriggerFence</span></dt><dd><pre class="literallayout">
fence: FENCE
Errors: <code class="function">Fence</code>
</pre><p>
This request puts the given fence in the triggered state after all rendering
from previous requests that affects resources owned by the fence's screen has
completed. This includes requests from other clients if those requests have
been dispatched. This request has no visible effects if the fence was already
in the triggered state. A <code class="function">Fence</code> error is generated if
fence does not name a valid fence.
      </p><p>
Note that the given fence's state is not necessarily directly modified by this
request.  The state change need only be queued to occur after the required
rendering has completed. Clients should take care to not assume the fence will
be in the triggered state in subsequent requests, such as those that operate
on the given fence immediately. <code class="function">AwaitFence</code> should first
be issued if subsequent requests require the fence to be in the triggered
state.
      </p></dd><dt><span class="term">ResetFence</span></dt><dd><pre class="literallayout">
fence: FENCE
Errors: <code class="function">Fence</code>,<code class="function">Match</code>
</pre><p>
This request immediately puts the given fence in the not triggered state.
A <code class="function">Match</code> error is generated if the fence is not in the
triggered state. A <code class="function">Fence</code> error is generated if fence
does not name a valid fence.
      </p><p>
See the warnings above regarding <code class="function">TriggerFence</code>'s delayed
effect.  In particular, a <code class="function">TriggerFence</code> request
immediately followed by a <code class="function">ResetFence</code> request is likely
to result in a <code class="function">Match</code> error. An
<code class="function">AwaitFence</code> request should be issued between the two.
      </p></dd><dt><span class="term">DestroyFence</span></dt><dd><pre class="literallayout">
fence: FENCE
Errors: <code class="function">Fence</code>
</pre><p>
This request destroys the given fence. All clients waiting on this fence are
released. A fence is destroyed automatically when the connection to the client
that created the fence is closed if the close-down mode is
<code class="function">DestroyAll</code>. A <code class="function">Fence</code> error is
generated if fence does not name a valid fence.
      </p></dd><dt><span class="term">QueryFence</span></dt><dd><pre class="literallayout">
fence: FENCE
=&gt;
triggered: BOOL
Errors: <code class="function">Fence</code>
</pre><p>
This request returns TRUE if the given fence is triggered, or FALSE if it
is not triggered.  A <code class="function">Fence</code> error is generated if
fence does not name a valid fence.
      </p></dd><dt><span class="term">AwaitFence</span></dt><dd><pre class="literallayout">
fence-list: LISTofFENCE
Errors: <code class="function">Fence</code>,<code class="function">Alloc</code>
</pre><p>
When this request is executed, the processing of further requests for the
client is blocked until one or more of the fences in fence-list reaches the
triggered state.  If any of the fences are already in the triggered state,
request processing resumes immediately. A <code class="function">Fence</code> error
is generated if any member of fence-list does not name a valid fence.
      </p></dd></dl></div></div><div class="sect1" title="Events"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="events"></a>Events</h2></div></div></div><div class="variablelist"><dl><dt><span class="term">CounterNotify</span></dt><dd><pre class="literallayout">
counter: COUNTER
wait-value: INT64
counter-value: INT64
time: TIME
count: CARD16
destroyed: BOOL
</pre><p>
<code class="function">CounterNotify</code> events may be generated when a client
becomes unblocked after an <code class="function">Await</code> request has been
processed. The wait-value is the value being waited for, and counter-value
is the actual value of the counter at the time the event was generated.
The destroyed flag is TRUE if this request was generated as the result of
the destruction of the counter and FALSE otherwise. The time is the server
time at which the event was generated.
      </p><p>
When a client is unblocked, all the <code class="function">CounterNotify</code>
events for the Await request are generated contiguously. If count is 0,
there are no more events to follow for this request. If count is n,
there are at least n more events to follow.
      </p></dd><dt><span class="term">AlarmNotify</span></dt><dd><pre class="literallayout">
alarm: ALARM
counter-value: INT64
alarm-value: INT64
state: ALARMSTATE
time: TIME
</pre><p>
An <code class="function">AlarmNotify</code> event is generated when an alarm is
triggered. alarm-value is the test value of the trigger in the alarm when
it was triggered, counter-value is the value of the counter that triggered
the alarm, and time is the server time at which the event was generated.
The state is the new state of the alarm. If state is
<code class="function">Inactive</code>, no more events will be generated by this
alarm until a <code class="function">ChangeAlarm</code> request is executed, the alarm
is destroyed, or the counter for the alarm is destroyed.
      </p></dd></dl></div></div></div><div class="chapter" title="Chapter 2. Encoding"><div class="titlepage"><div><div><h2 class="title"><a id="encoding"></a>Chapter 2. Encoding</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="#encoding_new_types">Encoding New Types</a></span></dt><dt><span class="sect1"><a href="#encoding_errors">Encoding Errors</a></span></dt><dt><span class="sect1"><a href="#encoding_requests">Encoding Requests</a></span></dt><dt><span class="sect1"><a href="#encoding_events">Encoding Events</a></span></dt></dl></div><p>
Please refer to the X11 Protocol Encoding document as this section uses
syntactic conventions established there and references types defined there.
</p><p>The name of this extension is "SYNC".</p><div class="sect1" title="Encoding New Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="encoding_new_types"></a>Encoding New Types</h2></div></div></div><p>
The following new types are used by the extension.
</p><pre class="literallayout">
ALARM: CARD32
ALARMSTATE:
       0         Active
       1         Inactive
       2         Destroyed
COUNTER: CARD32
INT64: 64-bit signed integer
SYSTEMCOUNTER:
       4         COUNTER                 counter
       8         INT64                   resolution
       2         n                       length of name in bytes
       n         STRING8                 name
       p                                 pad,p=pad(n+2)
TESTTYPE:
       0         PositiveTransition
       1         NegativeTransition
       2         PositiveComparison
       3         NegativeComparison
TRIGGER:
       4         COUNTER                 counter
       4         VALUETYPE               wait-type
       8         INT64                   wait-value
       4         TESTTYPE                test-type  VALUETYPE:
       0         Absolute
       1         Relative
WAITCONDITION:
       20        TRIGGER                 trigger
       8         INT64                   event threshold
FENCE: CARD32
</pre><p>
An INT64 is encoded in 8 bytes with the most significant 4 bytes
first followed by the least significant 4 bytes. Within these 4-byte
groups, the byte ordering determined during connection setup is used.
</p></div><div class="sect1" title="Encoding Errors"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="encoding_errors"></a>Encoding Errors</h2></div></div></div><pre class="literallayout">
<code class="function">Counter</code>
        1    0            Error
        1    Base + 0     code
        2    CARD16       sequence number
        4    CARD32       bad counter
        2    CARD16       minor opcode
        1    CARD8        major opcode
        21                unused
<code class="function">Alarm</code>
        1    0            Error
        1    Base + 1     code
        2    CARD16       sequence number
        4    CARD32       bad alarm
        2    CARD16       minor opcode
        1    CARD8        major opcode
        21                unused
<code class="function">Fence</code>
        1    0            Error
        1    Base + 2     code
        2    CARD16       sequence number
        4    CARD32       bad fence
        2    CARD16       minor opcode
        1    CARD8        major opcode
        21                unused
</pre></div><div class="sect1" title="Encoding Requests"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="encoding_requests"></a>Encoding Requests</h2></div></div></div><pre class="literallayout">
<code class="function">Initialize</code>
        1    CARD8        major opcode
        1    0            minor opcode
        2    2            request length
        1    CARD8        major version
        1    CARD8        minor version
        2                 unused
=&gt;
        1    1            Reply
        1                 unused
        2    CARD16       sequence number
        4    0            reply length
        1    CARD8        major version
        1    CARD8        minor version
        2                 unused
        20                unused

<code class="function">ListSystemCounters</code>
        1    CARD8                  major opcode
        1    1                      minor opcode
        2    1                      request length
=&gt;
        1    1                      Reply
        1                           unused
        2    CARD16                 sequence number
        4    0                      reply length
        4    INT32                  list length
        20                          unused
        4n   list of SYSTEMCOUNTER  system counters

<code class="function">CreateCounter</code>
        1    CARD8                  major opcode
        1    2                      minor opcode
        2    4                      request length
        4    COUNTER                id
        8    INT64                  initial value

<code class="function">DestroyCounter</code>
        1    CARD8                  major opcode
        1    6                      minor opcode<sup>[<a id="idp17814976" href="#ftn.idp17814976" class="footnote">1</a>]</sup>
        2    2                      request length
        4    COUNTER                counter
=&gt;
        1    1                      Reply
        1                           unused
        2    CARD16                 sequence number
        4    0                      reply length
        8    INT64                  counter value
        16                          unused

Await
        1    CARD8                  major opcode
        1    7                      minor opcode<sup>[<a id="idp17815792" href="#ftn.idp17815792" class="footnote">2</a>]</sup>
        2    1 + 7*n                request length
        28n  LISTofWAITCONDITION    wait conditions

ChangeCounter
        1    CARD8                  major opcode
        1    4                      minor opcode<sup>[<a id="idp17816344" href="#ftn.idp17816344" class="footnote">3</a>]</sup>
        2    4                      request length
        4    COUNTER                counter
        8    INT64                  amount

SetCounter
        1    CARD8                  major opcode
        1    3                      minor opcode<sup>[<a id="idp17816928" href="#ftn.idp17816928" class="footnote">4</a>]</sup>
        2    4                      request length
        4    COUNTER                counter
        8    INT64                  value

CreateAlarm
        1    CARD8                  major opcode
        1    8                      minor opcode
        2    3+n                    request length
        4    ALARM                  id
        4    BITMASK                values mask

             #x00000001             counter
             #x00000002             value-type
             #x00000004             value
             #x00000008             test-type
             #x00000010             delta
             #x00000020             events

        4n   LISTofVALUE            values

VALUES
        4    COUNTER                counter
        4    VALUETYPE              value-type
        8    INT64                  value
        4    TESTTYPE               test-type
        8    INT64                  delta
        4    BOOL                   events

ChangeAlarm
        1    CARD8                  major opcode
        1    9                      minor opcode
        2    3+n                    request length
        4    ALARM                  id
        4    BITMASK                values mask
             encodings as for <code class="function">CreateAlarm</code>
        4n   LISTofVALUE            values
             encodings as for <code class="function">CreateAlarm</code>

DestroyAlarm
        1    CARD8        major opcode
        1    11           minor opcode<sup>[<a id="idp17820568" href="#ftn.idp17820568" class="footnote">5</a>]</sup>
        2    2            request length
        4    ALARM        alarm

QueryAlarm
        1    CARD8        major opcode
        1    10           minor opcode<sup>[<a id="idp17821064" href="#ftn.idp17821064" class="footnote">6</a>]</sup>
        2    2            request length
        4    ALARM        alarm
=&gt;
        1    1            Reply
        1                 unused
        2    CARD16       sequence number
        4    2            reply length
        20   TRIGGER      trigger
        8    INT64        delta
        1    BOOL         events
        1    ALARMSTATE   state
        2                 unused

SetPriority
        1    CARD8        major opcode
        1    12           minor opcode
        2    3            request length
        4    CARD32       id
        4    INT32        priority

GetPriority
        1    CARD8        major opcode
        1    13           minor opcode
        2    1            request length
        4    CARD32       id
=&gt;
        1    1            Reply
        1                 unused
        2    CARD16       sequence number
        4    0            reply length
        4    INT32        priority
        20                unused

CreateFence
        1    CARD8        major opcode
        1    14           minor opcode
        2    4            request length
        4    DRAWABLE     drawable
        4    FENCE        id
        1    BOOL         initially triggered
        3                 unused

TriggerFence
        1    CARD8        major opcode
        1    15           minor opcode
        2    2            request length
        4    FENCE        id

ResetFence
        1    CARD8        major opcode
        1    16           minor opcode
        2    2            request length
        4    FENCE        id

DestroyFence
        1    CARD8        major opcode
        1    17           minor opcode
        2    2            request length
        4    FENCE        id

QueryFence
        1    CARD8        major opcode
        1    18           minor opcode
        2    2            request length
        4    FENCE        id
=&gt;
        1    1            Reply
        1                 unused
        2    CARD16       sequence number
        4    0            reply length
        1    BOOL         triggered
        23                unused

AwaitFence
        1    CARD8        major opcode
        1    19           minor opcode
        2    1 + n        request length
        4*n  LISTofFENCE  wait conditions
        
</pre></div><div class="sect1" title="Encoding Events"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="encoding_events"></a>Encoding Events</h2></div></div></div><pre class="literallayout">
<code class="function">CounterNotify</code>
        1    Base + 0     code
        1    0            kind
        2    CARD16       sequence number
        4    COUNTER      counter
        8    INT64        wait value
        8    INT64        counter value
        4    TIME         timestamp
        2    CARD16       count
        1    BOOL         destroyed
        1                 unused

<code class="function">AlarmNotify</code>
        1    Base + 1     code
        1    1            kind
        2    CARD16       sequence number
        4    ALARM        alarm
        8    INT64        counter value
        8    INT64        alarm value
        4    TIME         timestamp
        1    ALARMSTATE   state
        3                 unused
</pre></div><div class="footnotes"><br /><hr width="100" align="left" /><div class="footnote"><p><sup>[<a id="ftn.idp17814976" href="#idp17814976" class="para">1</a>] </sup>A previous version of this document gave an incorrect minor opcode</p></div><div class="footnote"><p><sup>[<a id="ftn.idp17815792" href="#idp17815792" class="para">2</a>] </sup>A previous version of this document gave an incorrect minor opcode.</p></div><div class="footnote"><p><sup>[<a id="ftn.idp17816344" href="#idp17816344" class="para">3</a>] </sup>A previous version of this document gave an incorrect minor opcode.</p></div><div class="footnote"><p><sup>[<a id="ftn.idp17816928" href="#idp17816928" class="para">4</a>] </sup>A previous version of this document gave an incorrect minor opcode.</p></div><div class="footnote"><p><sup>[<a id="ftn.idp17820568" href="#idp17820568" class="para">5</a>] </sup>A previous version of this document gave an incorrect minor opcode.</p></div><div class="footnote"><p><sup>[<a id="ftn.idp17821064" href="#idp17821064" class="para">6</a>] </sup>A previous version of this document gave an incorrect minor opcode.</p></div></div></div></div></body></html>
