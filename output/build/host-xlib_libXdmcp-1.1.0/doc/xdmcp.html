<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>X Display Manager Control Protocol</title><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /></head><body><div class="book" title="X Display Manager Control Protocol"><div class="titlepage"><div><div><h1 class="title"><a id="xdmcp"></a>X Display Manager Control Protocol</h1></div><div><h2 class="subtitle">X.Org Standard</h2></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Keith</span> <span class="surname">Packard</span></h3><div class="affiliation"><span class="orgname">
X Consortium,
Laboratory for Computer Science,
Massachusetts Institute of Technology
      <br /></span></div></div></div></div><div><p class="releaseinfo">Version 1.1</p></div><div><p class="copyright">Copyright © 1989 The Open Group</p></div><div><p class="copyright">Copyright © 2004 The Open Group</p></div><div><div class="legalnotice" title="Legal Notice"><a id="idp4900104"></a><p>
Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:
</p><p>
The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.
</p><p>
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
OPEN GROUP BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</p><p>
Except as contained in this notice, the name of The Open Group shall not be
used in advertising or otherwise to promote the sale, use or other dealings
in this Software without prior written authorization from The Open Group.
</p><p>
<span class="emphasis"><em>X Window System</em></span> is a trademark of The Open Group.
</p></div></div></div><hr /></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="chapter"><a href="#TITLE">1. TITLE</a></span></dt><dd><dl><dt><span class="sect1"><a href="#Purpose_and_Goals">Purpose and Goals</a></span></dt><dt><span class="sect1"><a href="#Overview_of_the_Protocol">Overview of the Protocol</a></span></dt><dt><span class="sect1"><a href="#Data_Types">Data Types</a></span></dt><dt><span class="sect1"><a href="#Packet_Format">Packet Format</a></span></dt><dt><span class="sect1"><a href="#Protocol">Protocol</a></span></dt><dt><span class="sect1"><a href="#Session_Termination">Session Termination</a></span></dt><dt><span class="sect1"><a href="#State_Diagrams">State Diagrams</a></span></dt><dt><span class="sect1"><a href="#Protocol_Encoding">Protocol Encoding</a></span></dt><dt><span class="sect1"><a href="#Display_Class_Format">Display Class Format</a></span></dt><dt><span class="sect1"><a href="#Manufacturer_Display_ID_Format">Manufacturer Display ID Format</a></span></dt><dt><span class="sect1"><a href="#Authentication">Authentication</a></span></dt></dl></dd></dl></div><div class="chapter" title="Chapter 1. TITLE"><div class="titlepage"><div><div><h2 class="title"><a id="TITLE"></a>Chapter 1. TITLE</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="#Purpose_and_Goals">Purpose and Goals</a></span></dt><dt><span class="sect1"><a href="#Overview_of_the_Protocol">Overview of the Protocol</a></span></dt><dt><span class="sect1"><a href="#Data_Types">Data Types</a></span></dt><dt><span class="sect1"><a href="#Packet_Format">Packet Format</a></span></dt><dt><span class="sect1"><a href="#Protocol">Protocol</a></span></dt><dt><span class="sect1"><a href="#Session_Termination">Session Termination</a></span></dt><dt><span class="sect1"><a href="#State_Diagrams">State Diagrams</a></span></dt><dt><span class="sect1"><a href="#Protocol_Encoding">Protocol Encoding</a></span></dt><dt><span class="sect1"><a href="#Display_Class_Format">Display Class Format</a></span></dt><dt><span class="sect1"><a href="#Manufacturer_Display_ID_Format">Manufacturer Display ID Format</a></span></dt><dt><span class="sect1"><a href="#Authentication">Authentication</a></span></dt></dl></div><div class="sect1" title="Purpose and Goals"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Purpose_and_Goals"></a>Purpose and Goals</h2></div></div></div><p>

The purpose of the X Display Manager Control Protocol (XDMCP)
is to provide a uniform mechanism for an autonomous
display to request login service from a remote host.
By autonomous, we mean
the display consists of hardware and processes that are independent of any
particular host where login service is desired.  (For example, the server
cannot simply be started by a
<code class="function">fork/exec</code>
sequence on the host.)
An X terminal (screen, keyboard, mouse, processor, network interface)
is a prime example of an autonomous display.
</p><p>
From the point of view of the end user, it is very important to make
autonomous displays as easy to use as traditional hardwired character
terminals.  Specifically, you can typically just power on a hardwired
terminal and be greeted with a login prompt.  The same should be possible
with autonomous displays.  However, in a network environment with multiple
hosts, the end user may want to choose which host(s) to connect to.  In an
environment with many displays and many hosts, a site administrator may want
to associate particular collections of hosts with particular displays.  We
would like to support the following options:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
The display has a single, fixed host to which it should connect.  It should be
possible to power on the display and receive a login prompt, without user
intervention.
    </p></li><li class="listitem"><p>
Any one of several hosts on a network or subnetwork may be acceptable
for accepting login from the display.
(For example, the user's file systems can be mounted onto
any such host, providing comparable environments.)  It should be possible
for the display to broadcast to find such hosts and to have the display
either automatically choose a host or present the possible hosts to the
user for selection.
    </p></li><li class="listitem"><p>
The display has a fixed set of hosts that it can connect to.  It should be
possible for the display to have that set stored in RAM, but it should also be
possible for a site administrator to be able to maintain host sets for a
large number of displays using a centralized facility, without having to
interact (physically or electronically) with each individual display.
Particular hosts should be allowed to refuse login service, based on
whatever local criteria are desired.
    </p></li></ul></div><p>
The control protocol should be designed in such a way that it can be used over
a reasonable variety of communication transport layers.  In fact, it is quite
desirable if every major network protocol family that supports the standard X
protocol is also capable of supporting XDMCP, because the end result of XDMCP
negotiation will be standard X protocol connections to the display.
However, because the number of displays per host may be large,
a connection-based protocol appears less desirable
than a connection-less protocol.  For this reason the protocol is designed
to use datagram services with the display responsible for sequencing and
retransmission.
</p><p>

To keep the burden on displays at a minimum (because display cost is not
a factor that can be ignored), it is desirable that displays not be required
to maintain permanent state (across power cycles) for the purposes
of the control protocol,
and it is desirable to keep required state at a minimum while the
display is powered on.
</p><p>

Security is an important consideration and must be an integral part of the
design.  The important security goals in the context of XDMCP are:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
It should be possible for the display to verify that it is communicating
with a legitimate host login service.  Because the user will present
credentials (for example, password) to this service,
it is important to avoid spoof attacks.
    </p></li><li class="listitem"><p>
It should be possible for the display and the login service to negotiate the
authorization mechanism to be used for the standard X protocol.
    </p></li><li class="listitem"><p>
It should be possible to provide the same level of security in verifying the
login service as is provided by the negotiated authorization mechanism.
    </p></li><li class="listitem"><p>
Because there are no firm standards yet in the area of security,
XDMCP must be flexible enough to accomodate a variety of security mechanisms.
    </p></li></ul></div></div><div class="sect1" title="Overview of the Protocol"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Overview_of_the_Protocol"></a>Overview of the Protocol</h2></div></div></div><p>

XDMCP is designed to provide authenticated access to display management
services for remote displays.  A new network server, called a \fIDisplay
Manager\fP, will use XDMCP to communicate with displays to negotiate the
startup of X sessions.  The protocol allows the display to authenticate the
manager.  It also allows most of the configuration information to be
centralized with the manager and to ease the burden of system administration
in a large network of displays.
The essential goal is to provide plug-and-play
services similar to those provided in the familiar mainframe/terminal world.
</p><p>

Displays may be turned off by the user at any time.  Any existing session
running on a display that has been turned off must be identifiable.  This
is made possible by requiring a three-way handshake to start a session.  If
the handshake succeeds, any existing session is terminated immediately and a
new session started.  There is the problem (at least with TCP) that
connections may not be closed when the display is turned off.  In most
environments, the manager should reduce this problem by periodically XSync'ing
on its own connection, perhaps every five to ten minutes, and terminating the
session if its own connection ever closes.
</p><p>

Displays should not be required to retain permanent state for purposes of
the control protocol.  One solution to packets received out of sequence
would be to use monotonically increasing message identifiers in each message
to allow both sides to ignore messages that arrive out-of-sequence.  For
this to work, displays would at a minimum have to increment a stable crash
count each time they are powered on and use that number as part of a
larger sequence number.  But if displays cannot retain permanent state this
cannot work.  Instead, the manager assumes the responsibility for permanent
state by generating unique numbers that identify a particular session and
the protocol simply ignores packets that correspond to an invalid session.
</p><p>

The Manager must not be responsible for packet reception.  To prevent the
Manager from becoming stuck because of a hostile display, no portion of the
protocol requires the Manager to retransmit a packet.  Part of this means
that any valid packet that the Manager does receive must be
acknowledged in some way to prevent the display from continuously resending
packets.  The display can keep the protocol running as it will always know
when the Manager has received (at least one copy of) a packet.  On the
Manager side, this means that any packet may be received more than once (if
the response was lost) and duplicates must be ignored.
</p></div><div class="sect1" title="Data Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Data_Types"></a>Data Types</h2></div></div></div><p>

XDMCP packets contain several types of data.  Integer values are always
stored most significant byte first in the packet ("Big Endian" order).
As XDMCP will not be used to transport large quantities of data, this
restriction will not substantially hamper the efficiency of any
implementation.  Also, no padding of any sort will occur within the packets.
</p><div class="informaltable"><table border="0"><colgroup><col align="left" class="c1" /><col align="left" class="c2" /><col align="left" class="c3" /></colgroup><thead><tr><th align="left">Type Name</th><th align="left">Length (Bytes)</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">CARD8</td><td align="left">1</td><td align="left">A single byte unsigned integer</td></tr><tr><td align="left">CARD16</td><td align="left">2</td><td align="left">Two byte unsigned integer</td></tr><tr><td align="left">CARD32</td><td align="left">4</td><td align="left">Four byte unsigned integer</td></tr><tr><td align="left">ARRAY8</td><td align="left">n+2</td><td align="left">
This is actually a CARD16 followed by
a collection of CARD8.  The value of the CARD16
field (n) specifies the number of CARD8 values to follow
      </td></tr><tr><td align="left">ARRAY16</td><td align="left">2*m+1</td><td align="left">
This is a CARD8 (m) which specifies the
number of CARD16 values to follow
      </td></tr><tr><td align="left">ARRAY32</td><td align="left">4*l+1</td><td align="left">
This is a CARD8 (l) which specifies the
number of CARD32 values to follow
      </td></tr><tr><td align="left">ARRAYofARRAY8</td><td align="left">?</td><td align="left">
This is a CARD8 which specifies the
number of ARRAY8 values to follow.
      </td></tr></tbody></table></div></div><div class="sect1" title="Packet Format"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Packet_Format"></a>Packet Format</h2></div></div></div><p>
All XDMCP packets have the following information:
</p><div class="informaltable"><table border="0"><colgroup><col align="left" class="c1" /><col align="left" class="c2" /><col align="left" class="c3" /></colgroup><thead><tr><th align="left">Length (Bytes)</th><th align="left">Field Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">2</td><td align="left">CARD16</td><td align="left">version number</td></tr><tr><td align="left">2</td><td align="left">CARD16</td><td align="left">opcode packet header</td></tr><tr><td align="left">2</td><td align="left">CARD16</td><td align="left">n = length of remaining data in bytes</td></tr><tr><td align="left">n</td><td align="left">???</td><td align="left">packet-specific data</td></tr></tbody></table></div><p>

The fields are as follows:
</p><div class="variablelist"><dl><dt><span class="term">Version number</span></dt><dd><p>
This specifies the version of XDMCP that generated this packet in
case changes in this protocol are required.  Displays and
managers may choose to support older versions for compatibility.
This field will initially be one (1).
      </p></dd><dt><span class="term">Opcode</span></dt><dd><p>
This specifies what step of the protocol this packet represents and should
contain one of the following values (encoding provided in section below):
<span class="bold"><strong>BroadcastQuery</strong></span>,
<span class="bold"><strong>Query</strong></span>,
<span class="bold"><strong>IndirectQuery</strong></span>,
<span class="bold"><strong>ForwardQuery</strong></span>,
<span class="bold"><strong>Willing</strong></span>,
<span class="bold"><strong>Unwilling</strong></span>,
<span class="bold"><strong>Request</strong></span>,
<span class="bold"><strong>Accept</strong></span>,
<span class="bold"><strong>Decline</strong></span>,
<span class="bold"><strong>Manage</strong></span>,
<span class="bold"><strong>Refuse</strong></span>,
<span class="bold"><strong>Failed</strong></span>,
<span class="bold"><strong>KeepAlive</strong></span>
or
<span class="bold"><strong>Alive</strong></span>.
      </p></dd><dt><span class="term">Length of data in bytes</span></dt><dd><p>
This specifies the length of the information following the first 6 bytes.
Each packet-type has a different format and will need to be separately
length-checked against this value.  Because every data item has either an
explicit or implicit length, this can be easily accomplished.
Packets that have too little or too much data should be ignored.
      </p></dd></dl></div><p>
Packets should be checked to make sure that they satisfy the following
conditions:
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
They must contain valid opcodes.
    </p></li><li class="listitem"><p>
The length of the remaining data should correspond to the sum of the
lengths of the individual remaining data items.
    </p></li><li class="listitem"><p>
The opcode should be expected (a finite state diagram is given
in a later section).
    </p></li><li class="listitem"><p>
If the packet is of type
<span class="bold"><strong>Manage</strong></span> or
<span class="bold"><strong>Refuse</strong></span>,
the Session ID should match the value sent in the preceding
<span class="bold"><strong>Accept</strong></span> packet.
    </p></li></ol></div></div><div class="sect1" title="Protocol"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Protocol"></a>Protocol</h2></div></div></div><p>
Each of the opcodes is described below.  Because a given packet type is only
ever sent one way, each packet description below indicates the direction.
Most of the packets have additional information included beyond the
description above.  The additional information is appended to the packet
header in the order described without padding, and the length field is
computed accordingly.
</p><div class="informaltable"><table border="0"><colgroup><col align="left" class="col1" /><col align="left" class="col2" /><col align="left" class="col3" /><col align="left" class="col4" /><col align="left" class="col5" /><col align="left" class="col6" /><col align="left" class="col7" /><col align="left" class="col8" /><col align="left" class="col9" /><col align="left" class="col10" /></colgroup><tbody><tr><td colspan="10" align="left"><span class="bold"><strong>Query</strong></span></td></tr><tr><td colspan="10" align="left"><span class="bold"><strong>BroadcastQuery</strong></span></td></tr><tr><td colspan="10" align="left"><span class="bold"><strong>IndirectQuery</strong></span></td></tr><tr><td align="left"> </td><td colspan="9" align="left">Display -&gt; Manager</td></tr><tr><td align="left"> </td><td colspan="9" align="left">Additional Fields:</td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Authentication Names</em></span>: ARRAYofARRAY8
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Specifies a list of authentication names that the display supports.  The
manager will choose one of these and return it in the
<span class="bold"><strong>Willing</strong></span> packet.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left">Semantics</td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td><td class="auto-generated"> </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
<p>
A <code class="function">Query</code>
packet is sent from the display to a specific host to ask if
that host is willing to provide management services to this display.  The
host should respond with
<code class="function">Willing</code>
if it is willing to service the display or
<code class="function">Unwilling</code>
if it is not.
</p>

<p>
A
<code class="function">BroadcastQuery</code>
packet is similar to the
<code class="function">Query</code>
packet except that it is intended to be received by all hosts on the network
(or subnetwork).  However, unlike
<code class="function">Query</code>
requests, hosts that are not willing to service the display
should simply ignore
<code class="function">BroadcastQuery</code>
requests.
</p>

<p>
An
<code class="function">IndirectQuery</code>
packet is sent to a well known manager that forwards
the request to a larger collection of secondary managers using
<code class="function">ForwardQuery</code>
packets.
In this way, the collection of managers that respond can be grouped
on other than network boundaries; the use of a central manager reduces
system administrative overhead.
The primary manager may also send a
<code class="function">Willing</code>
packet in response to this packet.
</p>

<p>
Each packet type has slightly different semantics:
</p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
<p>
The
<code class="function">Query</code>
packet is destined only for a single host.
If the display is instructed to
<code class="function">Query</code>
multiple managers, it will send multiple
<code class="function">Query</code>
packets.  The
<code class="function">Query</code>
packet also demands a response from the manager, either
<code class="function">Willing</code>
or
<code class="function">Unwilling</code>.
    </p>
    <p>
The
<code class="function">BroadcastQuery</code>
packet is sent to many hosts.
Each manager that receives this packet will not respond with an
<code class="function">Unwilling</code>
packet.
    </p>
    <p>
The
<code class="function">IndirectQuery</code>
packet is sent to only one manager with the request
that the request be forwarded to a larger list of managers using
<code class="function">ForwardQuery</code>
packets.  This list is expected to be maintained at one
central site to reduce administrative overhead.
The function of this packet type is similar to
<code class="function">BroadcastQuery except that</code>
<code class="function">BroadcastQuery</code>
is not forwarded.
    </p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">Valid Responses:</td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<code class="function">Willing</code>,
<code class="function">Unwilling</code>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">Problems/Solutions:</td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">Problem:</td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
<p>Not all managers receive the query packet.</p>
<p>Indication:</p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
None if
<code class="function">BroadcastQuery</code>
or
<code class="function">IndirectQuery</code>
was sent, else failure to receive
<code class="function">Willing</code>.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">Solution:</td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Repeatedly send the packet while waiting for user to choose a manager.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Timeout/Retransmission policy:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
An exponential backoff algorithm should be used here to reduce network load
for long-standing idle displays.  Start at 2 seconds, back off by factors of
2 to 32 seconds, and discontinue retransmit after 126 seconds.  The display
should reset the timeout when user-input is detected.  In this way, the
display will wakeup when touched by the user.
      </td></tr><tr><td colspan="10" align="left">
<code class="function">ForwardQuery</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
<p>Primary Manager -&gt; Secondary Manager</p>
<p>Additional Fields:</p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Client Address</em></span>: ARRAY8
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Specifies the network address of the client display.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Client Port</em></span>: ARRAY8
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Specifies an identification of the client task on the client display.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Authentication Names</em></span>: ARRAYofARRAY8
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Is a duplicate of Authentication Names array that was received
in the
<code class="function">IndirectQuery</code>
packet.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Semantics:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
        <p>
When primary manager receives a
<code class="function">IndirectQuery</code>
packet, it is responsible for sending
<code class="function">ForwardQuery</code>
packets to an appropriate list of
managers that can provide service to the display using the same network
type as the one the original
<code class="function">IndirectQuery</code>
packet was received from.
The Client Address and Client Port fields must contain an
address that the secondary manager can use to reach the display also using
this same network.  Each secondary manager sends a
<code class="function">Willing</code>
packet to the display if it is willing to provide service.
        </p>

        <p>
<code class="function">ForwardQuery</code>
packets are similar to
<code class="function">BroadcastQuery</code>
packets in that managers that are not willing to service
particular displays should not send a
<code class="function">Unwilling</code>
packet.
        </p>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Valid Responses:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<code class="function">Willing</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Problems/Solutions:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Identical to
<code class="function">BroadcastQuery</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Timeout/Retransmission policy:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Like all packets sent from a manager, this packet should never be
retransmitted.
      </td></tr><tr><td colspan="10" align="left">
<code class="function">Willing</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
        <p>
Manager -&gt; Display
        </p>
        <p>
Additional Fields:
        </p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Authentication Name</em></span>: ARRAY8
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
<p>
Specifies the authentication method, selected from the list offered in the
<code class="function">Query ,</code>
<code class="function">BroadcastQuery ,</code>
or
<code class="function">IndirectQuery</code>
packet that the manger expects the display to use in the subsequent
<code class="function">Request</code>
packet.
This choice should remain as constant as feasible so that displays that
send multiple
<code class="function">Query</code>
packets can use the Authentication Name from any
<code class="function">Willing</code>
packet that arrives.
</p>
<p>
The display is free to ignore managers that request an insufficient level
of authentication.
</p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Hostname</em></span>: ARRAY8
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Is a human readable string describing the host from which the packet was sent.
The protocol specifies no interpretation of the data in this field.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Status</em></span>: ARRAY8
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Is a human readable string describing the status of the host.  This could
include load average/number of users connected or other information.  The
protocol specifies no interpretation of the data in this field.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Semantics:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
A
<code class="function">Willing</code>
packet is sent by managers that may service connections from
this display.  It is sent in response to either a
<code class="function">Query ,</code>
<code class="function">BroadcastQuery ,</code>
or
<code class="function">ForwardQuery</code>
but does not imply a commitment to provide service
(for example, it may later decide that it has accepted enough
connections already).
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Problems/Solutions:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Problem:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
<p>
<code class="function">Willing</code>
not received by the display.
</p>
<p>
Indication:
</p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
None if
<code class="function">BroadcastQuery</code>
or
<code class="function">IndirectQuery</code>
was sent, else failure to receive
<code class="function">Willing .</code>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Solution:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
The display should continue to send the query until a response is received.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Timeout/Retransmission policy:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Like all packets sent from the manager to the display, this packet should
never be retransmitted.
      </td></tr><tr><td colspan="10" align="left">
<code class="function">Unwilling</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
        <p>
Manager -&gt; Display
        </p>
        <p>
Additional Fields:
        </p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
The Hostname and Status fields as in the
<code class="function">Willing</code>
packet.
The Status field should indicate to the user a reason
for the refusal of service.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Semantics:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
An
<code class="function">Unwilling</code>
packet is sent by managers in response to direct
<code class="function">Query</code>
requests (as opposed to
<code class="function">BroadcastQuery</code>
or
<code class="function">IndirectQuery</code>
requests) if the manager will not accept requests for management.
This is typically sent by managers that wish to only service
particular displays or that handle a limited number of displays at once.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Problems/Solutions:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Problem:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
<p>
<code class="function">Unwilling</code>
not received by the display.
</p>
<p>
Indication:
</p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Display fails to receive
<code class="function">Unwilling .</code>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Solution:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
The display should continue to send
<code class="function">Query</code>
messages until a response is received.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Timeout/Retransmission policy:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Like all packets sent from the manager to the display, this packet should
never be retransmitted.
      </td></tr><tr><td colspan="10" align="left">
<code class="function">Request</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
        <p>
Display -&gt; Manager
        </p>
        <p>
Additional Fields:
        </p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Display Number</em></span>: CARD16
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Specifies the index of this particular server for the host
on which the display is resident.
This value will be zero for most autonomous displays.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Connection Types</em></span>: ARRAY16
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Specifies an array indicating the stream services accepted by the display.
If the high-order byte in a particular entry is zero, the low-order byte
corresponds to an X-protocol host family type.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Connection Addresses</em></span>: ARRAYofARRAY8
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
For each connection type in the previous array, the corresponding entry in
this array indicates the network address of the display device.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
        <p>
<span class="emphasis"><em>Authentication Name</em></span>: ARRAY8
        </p>
        <p>
<span class="emphasis"><em>Authentication Data</em></span>: ARRAY8
        </p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Specifies the authentication protocol that the display expects
the manager to validate itself with.  The Authentication Data is
expected to contain data that the manager will interpret, modify
and use to authenticate itself.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Authorization Names</em></span>: ARRAYofARRAY8
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Specifies which types of authorization the display supports.  The
manager may decide to reject displays with which it cannot perform
authorization.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Manufacturer Display ID</em></span>: ARRAY8
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Can be used by the manager to determine how to decrypt the
Authentication Data field in this packet.  See the section below on
Manufacturer Display ID Format.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Semantics:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
A
<code class="function">Request</code>
packet is sent by a display to a specific host to request a
session ID in preparation for a establishing a connection.  If the manager
is willing to service a connection to this display, it should return an
<code class="function">Accept</code>
packet with a valid session ID and should be ready for a subsequent
<code class="function">Manage</code>
request.  Otherwise, it should return a
<code class="function">Decline</code>
packet.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Valid Responses:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<code class="function">Accept ,</code>
<code class="function">Decline</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Problems/Solutions:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Problem:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Request not received by manager.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Indication:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Display timeout waiting for response.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Solution:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Display resends
<code class="function">Request</code>
message.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Problem:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Message received out of order by manager.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Indication:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
None.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Solution:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Each time a
<code class="function">Request</code>
is sent, the manager sends the Session ID
associated with the next session in the
<code class="function">Accept .</code>
If that next session is not yet started,
the manager will simply resend with the same Session ID.
If the session is in progress, the manager will reply
with a new Session ID; in which case, the
<code class="function">Accept</code>
will be discarded by the display.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Timeout/Retransmission policy:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Timeout after 2 seconds, exponential backoff to 32 seconds.
After no more than 126 seconds, give up and report an error to the user.
      </td></tr><tr><td colspan="10" align="left">
<code class="function">Accept</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
        <p>
Manager -&gt; Display
        </p>
        <p>
Additional Fields:
        </p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Session ID</em></span>: CARD32
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Identifies the session that can be started by the manager.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
        <p>
<span class="emphasis"><em>Authentication Name</em></span>: ARRAY8
        </p>
        <p>
<span class="emphasis"><em>Authentication Data</em></span>: ARRAY8
        </p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Is the data sent back to the display to authenticate the manager.
If the Authentication Data is not the value expected by the display, it
should terminate the protocol at this point and display an error to the user.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
        <p>
<span class="emphasis"><em>Authorization Name</em></span>: ARRAY8
        </p>
        <p>
<span class="emphasis"><em>Authorization Data</em></span>: ARRAY8
        </p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Is the data sent to the display to indicate the type of authorization the
manager will be using in the first call to
<code class="function">XOpenDisplay</code>
after the
<code class="function">Manage</code>
packet is received.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Semantics:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<p>
An
<code class="function">Accept</code>
packet is sent by a manager in response to a
<code class="function">Request</code>
packet if the manager is willing to establish a connection for the display.
The Session ID is used to identify this connection from any preceding
ones and will be used by the display in its subsequent
<code class="function">Manage</code>
packet.
The Session ID is a 32-bit number that is incremented each time an
<code class="function">Accept</code>
packet is sent as it must be unique over a reasonably long period of time.
</p>
<p>
If the authentication information is invalid, a
<code class="function">Decline</code>
packet will be returned with an appropriate
<code class="function">Status</code>
message.
</p>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Problems/Solutions:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Problem:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
<code class="function">Accept</code>
or
<code class="function">Decline</code>
not received by display.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Indication:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Display timeout waiting for response to
<code class="function">Request .</code>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Solution:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Display resends
<code class="function">Request</code>
message.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Problem:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Message received out of order by display.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Indication:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Display receives
<code class="function">Accept</code>
after
<code class="function">Manage</code>
has been sent.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Solution:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Display discards
<code class="function">Accept</code>
messages after it has sent a
<code class="function">Manage</code>
message.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Timeout/Retransmission policy:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Like all packets sent from the manager to the display, this packet should
never be retransmitted.
      </td></tr><tr><td colspan="10" align="left">
<code class="function">Decline</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
        <p>
Manager -&gt; Display
        </p>
        <p>
Additional Fields:
        </p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Status</em></span>: ARRAY8
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Is a human readable string indicating the reason for refusal of
service.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
        <p>
<span class="emphasis"><em>Authentication Name</em></span>:
ARRAY8
        </p>
        <p>
<span class="emphasis"><em>Authentication Data</em></span>:
ARRAY8
        </p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Is the data sent back to the display to authenticate the manager.  If the
Authentication Data is not the value expected by the display, it
should terminate the protocol at this point and display an error to the user.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Semantics:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
A
<code class="function">Decline</code>
packet is sent by a manager in response to a
<code class="function">Request</code>
packet if the manager is unwilling to establish a connection for the
display.
This is allowed even if the manager had responded
<code class="function">Willing</code>
to a previous query.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Problems/Solutions:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Same as for
<code class="function">Accept .</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Timeout/Retransmission policy:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Like all packets sent from a manager to a display, this packet should never
be retransmitted.
      </td></tr><tr><td colspan="10" align="left">
<code class="function">Manage</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
        <p>
Display -&gt; Manager
        </p>
        <p>
Additional Fields:
        </p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Session ID</em></span>: CARD32
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Should contain the nonzero session ID returned in the
<code class="function">Accept</code>
packet.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Display Number</em></span>: CARD16
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Must match the value sent in the previous
<code class="function">Request</code>
packet.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Display Class</em></span>: ARRAY8
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Specifies the class of the display.
See the Display Class Format section,
which discusses the format of this field.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Semantics:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
A
<code class="function">Manage</code>
packet is sent by a display to ask the manager to begin a
session on the display.  If the Session ID is correct the manager
should open a connection; otherwise, it should respond with a
<code class="function">Refuse</code>
or
<code class="function">Failed</code>
packet, unless the Session ID matches a currently
running session or a session that has not yet successfully opened the
display but has not given up the attempt.  In this latter case, the
<code class="function">Manage</code>
packet should be ignored.
This will work as stream connections give positive success indication
to both halves of the stream, and positive failure indication
to the connection initiator (which will eventually generate a
<code class="function">Failed</code>
packet).
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Valid Responses:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
X connection with correct auth info,
<code class="function">Refuse ,</code>
<code class="function">Failed .</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Problems/Solutions:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Problem:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
<code class="function">Manage</code>
not received by manager.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Indication:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Display timeout waiting for response.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Solution:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Display resends
<code class="function">Manage</code>
message.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Problem:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
<code class="function">Manage</code>
received out of order by manager.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Indication:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Session already in progress with matching Session ID.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Solution:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
<code class="function">Manage</code>
packet ignored.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Indication:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Session ID does not match next Session ID.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Solution:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
<code class="function">Refuse</code>
message is sent.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Problem:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Display cannot be opened on selected stream.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Indication:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Display connection setup fails.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Solution:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
<code class="function">Failed</code>
message is sent including a human readable reason.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Problem:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Display open does not succeed before a second manage packet is received
because of a timeout occuring in the display.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Indication:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
<code class="function">Manage</code>
packet received with Session ID matching the session
attempting to connect to the display.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Solution:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
<code class="function">Manage</code>
packet is ignored.  As the stream connection will either
succeed, which will result in an active session, or the stream will
eventually give up hope of connecting and send a
<code class="function">Failed</code>
packet; no response to this
<code class="function">Manage</code>
packet is necessary.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Timeout/Retransmission policy:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Timeout after 2 seconds, exponential backoff to 32 seconds.  After no more
than 126 seconds, give up and report an error to the user.
      </td></tr><tr><td colspan="10" align="left">
<code class="function">Refuse</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
        <p>
Manager -&gt; Display
        </p>
        <p>
Additional Fields:
        </p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Session ID</em></span>: CARD32
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Should be set to the Session ID received in the
<code class="function">Manage</code>
packet.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Semantics:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
A
<code class="function">Refuse</code>
packet is sent by a manager when the Session ID received in the
<code class="function">Manage</code>
packet does not match the current Session ID.
The display should assume that it received an old
<code class="function">Accept</code>
packet and should resend its
<code class="function">Request</code>
packet.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Problems/Solutions:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Problem:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Error message is lost.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Indication:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Display times out waiting for
new connection,
<code class="function">Refuse</code>
or
<code class="function">Failed .</code>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Solution:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Display resends
<code class="function">Manage</code>
message.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Timeout/Retransmission policy:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Like all packets sent from a manager to a display, this packet should never be
retransmitted.
      </td></tr><tr><td colspan="10" align="left">
<code class="function">Failed</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
        <p>
Manager -&gt; Display
        </p>
        <p>
Additional Fields:
        </p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Session ID</em></span>: CARD32
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Should be set to the Session ID received in the
<code class="function">Manage</code>
packet.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Status</em></span>: ARRAY8
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Is a human readable string indicating the reason for failure.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Semantics:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
A
<code class="function">Failed</code>
packet is sent by a manager when it has problems establishing
the initial X connection in response to the
<code class="function">Manage</code>
packet.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Problems/Solutions
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Same as for
<code class="function">Refuse .</code>
      </td></tr><tr><td colspan="10" align="left">
<code class="function">KeepAlive</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
        <p>
Display -&gt; Manager
        </p>
        <p>
Additional Fields:
        </p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Display Number</em></span>: CARD16
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Set to the display index for the display host.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Session ID</em></span>: CARD32
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Should be set to the Session ID received in the
<code class="function">Manage</code>
packet during the negotiation for the current session.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Sematics:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
        <p>
A
<code class="function">KeepAlive</code>
packet can be sent at any time during the session by a
display to discover if the manager is running.
The manager should respond with
<code class="function">Alive</code>
whenever it receives this type of packet.
        </p>
        <p>
This allows the display to discover when the manager host
is no longer running.
A display is not required to send
<code class="function">KeepAlive</code>
packets and, upon lack of receipt of
<code class="function">Alive</code>
packets, is not required to perform any specific action.
        </p>
        <p>
The expected use of this packet is to terminate an active session when the
manager host or network link fails.  The display should keep track of the
time since any packet has been received from the manager host and use
<code class="function">KeepAlive</code>
packets when a substantial time has elapsed since the
most recent packet.
        </p>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Valid Responses:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<code class="function">Alive</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Problems/Solutions:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
Problem:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Manager does not receive the packet or display does not receive the response.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Indication:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
No
<code class="function">Alive</code>
packet is returned.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Solution:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="6" align="left">
Retransmit the packet with an exponential backoff; start at 2 seconds and
assume the host is not up after no less than 30 seconds.
      </td></tr><tr><td colspan="10" align="left">
<code class="function">Alive</code>
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
        <p>
Manager -&gt; Display
        </p>
        <p>
Additional Fields:
        </p>
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Session Running</em></span>: CARD8
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Indicates that the session identified by Session ID is
currently active.  The value is zero if no session is active
or one if a session
is active.
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
<span class="emphasis"><em>Session ID</em></span>: CARD32
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td align="left"> </td><td colspan="7" align="left">
Specifies the ID of the currently running session; if any.
When no session is active this field should be zero.
      </td></tr><tr><td align="left"> </td><td colspan="9" align="left">
Semantics:
      </td></tr><tr><td align="left"> </td><td align="left"> </td><td colspan="8" align="left">
An
<code class="function">Alive</code>
packet is sent in response to a
<code class="function">KeepAlive</code>
request.
If a session is currently active on the display, the manager includes the
Session ID in the packet.  The display can use this information to
determine the status of the manager.
      </td></tr></tbody></table></div></div><div class="sect1" title="Session Termination"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Session_Termination"></a>Session Termination</h2></div></div></div><p>
When the session is over, the initial connection with the display (the one
that acknowledges the
<code class="function">Manage</code>
packet) will be closed by the manager.
If only a single session was active on the display,
all other connections should be closed by the display
and the display should be reset.  If multiple sessions
are active simultaneously and the display can identify which connections
belong to the terminated sesssion, those connections should be closed.
Otherwise, all connections should be closed and the display reset only when
all sessions have been terminated (that is, all initial connections closed).
</p><p>
The session may also be terminated at any time by the display if the
managing host no longer responds to
<code class="function">KeepAlive</code>
packets.
The exact time-outs for sending
<code class="function">KeepAlive</code>
packets is not specified in this protocol as the trade off
should not be fixed between loading an otherwise idle system with spurious
<code class="function">KeepAlive</code>
packets and not noticing that the manager host is down for a long time.
</p></div><div class="sect1" title="State Diagrams"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="State_Diagrams"></a>State Diagrams</h2></div></div></div><p>

The following state diagrams are designed to cover all actions of both
the display and the manager.  Any packet that is received out-of-sequence
will be ignored.
</p><p>

Display:
</p><div class="variablelist"><dl><dt><span class="term"><span class="emphasis"><em>start</em></span>:</span></dt><dd><p>
User-requested connect to one host -&gt; <span class="emphasis"><em>query</em></span>
      </p><p>
User-requested connect to some host -&gt; <span class="emphasis"><em>broadcast</em></span>
      </p><p>
User-requested connect to site host-list -&gt; <span class="emphasis"><em>indirect</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>query</em></span>:</span></dt><dd><p>
Send <code class="function">Query</code> packet
-&gt; <span class="emphasis"><em>collect-query</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>collect-query</em></span>:</span></dt><dd><p>
Receive <code class="function">Willing</code> -&gt;
<span class="emphasis"><em>start-connection</em></span>
      </p><p>
Receive <code class="function">Unwilling</code> -&gt;
<span class="emphasis"><em>stop-connection</em></span>
      </p><p>
Timeout -&gt; <span class="emphasis"><em>query</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>broadcast</em></span>:</span></dt><dd><p>
Send <code class="function">BroadcastQuery</code> packet
      </p><p>
-&gt; <span class="emphasis"><em>collect-broadcast-query</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>collect-broadcast-query</em></span>:</span></dt><dd><p>
Receive <code class="function">Willing</code> -&gt;
<span class="emphasis"><em>update-broadcast-willing</em></span>
      </p><p>
User-requested connect to one host -&gt;
<span class="emphasis"><em>start-connection</em></span>
      </p><p>
Timeout -&gt; <span class="emphasis"><em>broadcast</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>update-broadcast-willing</em></span>:</span></dt><dd><p>
Add new host to the host list presented to the user
      </p><p>
-&gt; <span class="emphasis"><em>collect-broadcast-query</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>indirect</em></span>:</span></dt><dd><p>
Send <code class="function">IndirectQuery</code> packet
      </p><p>
-&gt; <span class="emphasis"><em>collect-indirect-query</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>collect-indirect-query</em></span>:</span></dt><dd><p>
Receive <code class="function">Willing</code> -&gt;
<span class="emphasis"><em>update-indirect-willing</em></span>
      </p><p>
User-requested connect to one host -&gt;
<span class="emphasis"><em>start-connection</em></span>
      </p><p>
Timeout -&gt; <span class="emphasis"><em>indirect</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>update-indirect-willing</em></span>:</span></dt><dd><p>
Add new host to the host list presented to the user
      </p><p>
-&gt; <span class="emphasis"><em>collect-indirect-query</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>start-connection</em></span>:</span></dt><dd><p>
Send <code class="function">Request</code> packet
      </p><p>
-&gt; <span class="emphasis"><em>await-request-response</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>await-request-response</em></span>:</span></dt><dd><p>
Receive <code class="function">Accept</code> -&gt;
<span class="emphasis"><em>manage</em></span>
      </p><p>
Receive <code class="function">Decline</code> -&gt;
<span class="emphasis"><em>stop-connection</em></span>
      </p><p>
Timeout -&gt; <span class="emphasis"><em>start-connection</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>manage</em></span>:</span></dt><dd><p>
Save Session ID
      </p><p>
Send <code class="function">Manage</code> packet with Session ID
      </p><p>
-&gt; <span class="emphasis"><em>await-manage-response</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>await-manage-response</em></span>:</span></dt><dd><p>
Receive <code class="function">XOpenDisplay :</code> -&gt;
<span class="emphasis"><em>run-session</em></span>
      </p><p>
Receive <code class="function">Refuse</code> with matching Session ID
-&gt; <span class="emphasis"><em>start-connection</em></span>
      </p><p>
Receive <code class="function">Failed</code> with matching Session ID
-&gt; <span class="emphasis"><em>stop-connection</em></span>
      </p><p>
Timeout -&gt; <span class="emphasis"><em>manage</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>stop-connection</em></span>:</span></dt><dd><p>
Display cause of termination to user
      </p><p>
-&gt; <span class="emphasis"><em>start</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>run-session</em></span>:</span></dt><dd><p>
Decide to send <code class="function">KeepAlive</code> packet -&gt;
<span class="emphasis"><em>keep-alive</em></span>
      </p><p>
wait close of first display connection
      </p><p>
-&gt; <span class="emphasis"><em>reset-display</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>keep-alive</em></span>:</span></dt><dd><p>
Send <code class="function">KeepAlive</code> packet with current Session ID
      </p><p>
-&gt; <span class="emphasis"><em>await-alive</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>await-alive</em></span>:</span></dt><dd><p>
Receive <code class="function">Alive</code> with matching Session ID -&gt;
<span class="emphasis"><em>run-session</em></span>
      </p><p>
Receive <code class="function">Alive</code> with nonmatching Session ID
or FALSE Session Running -&gt; <span class="emphasis"><em>reset-display</em></span>
      </p><p>
Final timeout without receiving <code class="function">Alive</code>
packet -&gt; <span class="emphasis"><em>reset-display</em></span>
      </p><p>
Timeout -&gt; <span class="emphasis"><em>keep-alive</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>reset-display</em></span>:</span></dt><dd><p>
(if possible) -&gt; close all display connections associated with this session
      </p><p>
Last session -&gt; close all display connections
      </p><p>
-&gt; <span class="emphasis"><em>start</em></span>
      </p></dd></dl></div><p>
Manager:
</p><div class="variablelist"><dl><dt><span class="term"><span class="emphasis"><em>idle</em></span>:</span></dt><dd><p>
Receive <code class="function">Query</code> -&gt;
<span class="emphasis"><em>query-respond</em></span>
      </p><p>
Receive
<code class="function">BroadcastQuery</code>
-&gt; <span class="emphasis"><em>broadcast-respond</em></span>
      </p><p>
Receive
<code class="function">IndirectQuery</code>
-&gt; <span class="emphasis"><em>indirect-respond</em></span>
      </p><p>
Receive
<code class="function">ForwardQuery</code>
-&gt; <span class="emphasis"><em>forward-respond</em></span>
Receive
      </p><p>
<code class="function">Request</code>
-&gt; <span class="emphasis"><em>request-respond</em></span>
      </p><p>
Receive
<code class="function">Manage</code>
-&gt; <span class="emphasis"><em>manage</em></span>
      </p><p>
An active session terminates
-&gt; <span class="emphasis"><em>finish-session</em></span>
      </p><p>
Receive <code class="function">KeepAlive</code>
-&gt; <span class="emphasis"><em>send-alive</em></span>
      </p><p>
-&gt; <span class="emphasis"><em>idle</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>query-respond</em></span>:</span></dt><dd><p>
If willing to manage -&gt; <span class="emphasis"><em>send-willing</em></span>
      </p><p>
-&gt; <span class="emphasis"><em>send-unwilling</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>broadcast-respond</em></span>:</span></dt><dd><p>
If willing to manage -&gt; <span class="emphasis"><em>send-willing</em></span>
      </p><p>
-&gt; <span class="emphasis"><em>idle</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>indirect-respond</em></span>:</span></dt><dd><p>
Send <code class="function">ForwardQuery</code>
packets to all managers on redirect list
      </p><p>
If willing to manage -&gt; <span class="emphasis"><em>send-willing</em></span>
      </p><p>
-&gt; <span class="emphasis"><em>idle</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>forward-respond</em></span>:</span></dt><dd><p>
Decode destination address, if willing to manage -&gt;
<span class="emphasis"><em>send-willing</em></span>
      </p><p>
-&gt; <span class="emphasis"><em>idle</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>send-willing</em></span>:</span></dt><dd><p>
Send <code class="function">Willing</code> packet
      </p><p>
-&gt; <span class="emphasis"><em>idle</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>send-unwilling</em></span>:</span></dt><dd><p>
Send <code class="function">Unwilling</code> packet
-&gt; <span class="emphasis"><em>idle</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>request-respond</em></span>:</span></dt><dd><p>
If manager is willing to allow a session on display
-&gt; <span class="emphasis"><em>accept-session</em></span>
      </p><p>
-&gt; <span class="emphasis"><em>decline-session</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>accept-session</em></span>:</span></dt><dd><p>
Generate Session ID and save Session ID, display address, and
display number somewhere
      </p><p>
Send <code class="function">Accept</code> packet
      </p><p>
-&gt; <span class="emphasis"><em>idle</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>decline-session</em></span>:</span></dt><dd><p>
Send <code class="function">Decline</code> packet
      </p><p>
-&gt; <span class="emphasis"><em>idle</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>manage</em></span>:</span></dt><dd><p>
If Session ID matches saved Session ID -&gt;
<span class="emphasis"><em>run-session</em></span>
      </p><p>
If Session ID matches Session ID of session in process of
starting up, or currently active session -&gt;
<span class="emphasis"><em>idle</em></span>
      </p><p>
-&gt; <span class="emphasis"><em>refuse</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>refuse</em></span>:</span></dt><dd><p>
Send <code class="function">Refuse</code> packet
      </p><p>
-&gt; <span class="emphasis"><em>idle</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>run-session</em></span>:</span></dt><dd><p>
Terminate any session in progress
      </p><p>
<code class="function">XOpenDisplay</code>
      </p><p>
Open display succeeds -&gt;
<span class="emphasis"><em>start-session</em></span>
      </p><p>
-&gt; <span class="emphasis"><em>failed</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>failed</em></span>:</span></dt><dd><p>
Send <code class="function">Failed</code> packet
      </p><p>
-&gt; <span class="emphasis"><em>idle</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>start-session</em></span>:</span></dt><dd><p>
Start a new session
      </p><p>
-&gt; <span class="emphasis"><em>idle</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>finish-session</em></span>:</span></dt><dd><p>
<code class="function">XCloseDisplay</code>
      </p><p>
-&gt; <span class="emphasis"><em>idle</em></span>
      </p></dd><dt><span class="term"><span class="emphasis"><em>send-alive</em></span>:</span></dt><dd><p>
Send <code class="function">Alive</code> packet containing current status
      </p><p>
-&gt; <span class="emphasis"><em>idle</em></span>
      </p></dd></dl></div></div><div class="sect1" title="Protocol Encoding"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Protocol_Encoding"></a>Protocol Encoding</h2></div></div></div><p>
When XDMCP is implemented on top of the Internet User Datagram Protocol (UDP),
port number 177 is to be used. When using UDP over IPv4, Broadcast Query
packets are sent via UDP broadcast.  When using UDP over IPv6, Broadcast Query
packets are sent via multicast, either to an address in the IANA registered
XDMCP multicast address range of
FF0<span class="emphasis"><em>X</em></span>:0:0:0:0:0:0:12B
(where the <span class="emphasis"><em>X</em></span> is replaced by a valid scope id)
or to a locally assigned
multicast address. The version number in all packets will be 1.
Packet opcodes are 16-bit integers.
</p><div class="informaltable"><table border="0"><colgroup><col align="left" class="c1" /><col align="left" class="c2" /></colgroup><thead><tr><th align="left">Packet Name</th><th align="left">Encoding</th></tr></thead><tbody><tr><td align="left">BroadcastQuery</td><td align="left">1</td></tr><tr><td align="left">Query</td><td align="left">2</td></tr><tr><td align="left">IndirectQuery</td><td align="left">3</td></tr><tr><td align="left">ForwardQuery</td><td align="left">4</td></tr><tr><td align="left">Willing</td><td align="left">5</td></tr><tr><td align="left">Unwilling</td><td align="left">6</td></tr><tr><td align="left">Request</td><td align="left">7</td></tr><tr><td align="left">Accept</td><td align="left">8</td></tr><tr><td align="left">Decline</td><td align="left">9</td></tr><tr><td align="left">Manage</td><td align="left">10</td></tr><tr><td align="left">Refuse</td><td align="left">11</td></tr><tr><td align="left">Failed</td><td align="left">12</td></tr><tr><td align="left">KeepAlive</td><td align="left">13
<sup>[<a id="idp7174168" href="#ftn.idp7174168" class="footnote">a</a>]</sup>
      </td></tr><tr><td align="left">Alive</td><td align="left">14
<sup>[<a id="idp7176000" href="#ftn.idp7176000" class="footnote">b</a>]</sup>
      </td></tr></tbody><tbody class="footnotes"><tr><td colspan="2"><div class="footnote"><p><sup>[<a id="ftn.idp7174168" href="#idp7174168" class="para">a</a>] </sup>
A previous version of this document incorrectly reversed the opcodes of
<span class="bold"><strong>Alive</strong></span> and
<span class="bold"><strong>KeepAlive</strong></span>.
</p></div><div class="footnote"><p><sup>[<a id="ftn.idp7176000" href="#idp7176000" class="para">b</a>] </sup>
A previous version of this document incorrectly reversed the opcodes of
<span class="bold"><strong>Alive</strong></span> and
<span class="bold"><strong>KeepAlive</strong></span>.
</p></div></td></tr></tbody></table></div><p>
Per packet information follows:
</p><p>
<code class="function">Query</code>,
<code class="function">BroadcastQuery</code>,
<code class="function">IndirectQuery</code>
</p><pre class="literallayout">
     2     CARD16     version number (always 1)
     2     CARD16     opcode (always Query, BroadcastQuery or IndirectQuery)
     2     CARD16     length
     1     CARD8      number of Authentication Names sent (m)
     2     CARD16     length of first Authentication Name (m<span class="subscript">1</span>)
     m<span class="subscript">1</span>   CARD8     first Authentication Name
     ...          Other Authentication Names
</pre><p>
Note that these three packets are identical except for the opcode field.
</p><pre class="literallayout">
<code class="function">ForwardQuery</code>
     2     CARD16     version number (always 1)
     2     CARD16     opcode (always ForwardQuery)
     2     CARD16     length
     2     CARD16     length of Client Address (m)
     m     CARD8     Client Address
     2     CARD16     length of Client Port (n)
     n     CARD8     Client Port
     1     CARD8     number of Authentication Names sent (o)
     2     CARD16     length of first Authentication Name (o<span class="subscript">1</span>)
     o<span class="subscript">1</span>     CARD8     first Authentication Name
     ...          Other Authentication Names
</pre><pre class="literallayout">
<code class="function">Willing</code>
     2     CARD16     version number (always 1)
     2     CARD16     opcode (always Willing)
     2     CARD16     length (6 + m + n + o)
     2     CARD16     Length of Authentication Name (m)
     m     CARD8      Authentication Name
     2     CARD16     Hostname length (n)
     n     CARD8      Hostname
     2     CARD16     Status length (o)
     o     CARD8      Status
</pre><pre class="literallayout">
<code class="function">Unwilling</code>
     2     CARD16     version number (always 1)
     2     CARD16     opcode (always Unwilling)
     2     CARD16     length (4 + m + n)
     2     CARD16     Hostname length (m)
     m     CARD8      Hostname
     2     CARD16     Status length (n)
     n     CARD8      Status
</pre><pre class="literallayout">
<code class="function">Request</code>
     2     CARD16     version number (always 1)
     2     CARD16     opcode (always Request)
     2     CARD16     length
     2     CARD16     Display Number
     1     CARD8      Count of Connection Types (m)
     2xm   CARD16     Connection Types
     1     CARD8      Count of Connection Addresses (n)
     2     CARD16     Length of first Connection Address (n<span class="subscript">1</span>)
     n<span class="subscript">1</span>     CARD8      First Connection Address
     ...              Other connection addresses
     2     CARD16     Length of Authentication Name (o)
     o     CARD8      Authentication Name
     2     CARD16     Length of Authentication Data (p)
     p     CARD8      Authentication Data
     1     CARD8      Count of Authorization Names (q)
     2     CARD16     Length of first Authorization Name (q<span class="subscript">1</span>)
     q<span class="subscript">1</span>     CARD8      First Authorization Name
     ...              Other authorization names
     2     CARD16     Length of Manufacturer Display ID (r)
     r     CARD8      Manufacturer Display ID
</pre><pre class="literallayout">
<code class="function">Accept</code>
     2     CARD16     version number (always 1)
     2     CARD16     opcode (always Accept)
     2     CARD16     length (12 + n + m + o + p)
     4     CARD32     Session ID
     2     CARD16     Length of Authentication Name (n)
     n     CARD8      Authentication Name
     2     CARD16     Length of Authentication Data (m)
     m     CARD8      Authentication Data
     2     CARD16     Length of Authorization Name (o)
     o     CARD8      Authorization Name
     2     CARD16     Length of Authorization Data (p)
     p     CARD8      Authorization Data
</pre><pre class="literallayout">
<code class="function">Decline</code>
     2     CARD16     version number (always 1)
     2     CARD16     opcode (always Decline)
     2     CARD16     length (6 + m + n + o)
     2     CARD16     Length of Status (m)
     m     CARD8      Status
     2     CARD16     Length of Authentication Name (n)
     n     CARD8      Authentication Name
     2     CARD16     Length of Authentication Data (o)
     o     CARD8      Authentication Data
</pre><pre class="literallayout">
<code class="function">Manage</code>
     2     CARD16     version number (always 1)
     2     CARD16     opcode (always Manage)
     2     CARD16     length (8 + m)
     4     CARD32     Session ID
     2     CARD16     Display Number
     2     CARD16     Length of Display Class (m)
     m     CARD8      Display Class
</pre><pre class="literallayout">
<code class="function">Refuse</code>
     2     CARD16     version number (always 1)
     2     CARD16     opcode (always Refuse)
     2     CARD16     length (4)
     4     CARD32     Session ID
</pre><pre class="literallayout">
<code class="function">Failed</code>
     2     CARD16     version number (always 1)
     2     CARD16     opcode (always Failed)
     2     CARD16     length (6 + m)
     4     CARD32     Session ID
     2     CARD16     Length of Status (m)
     m     CARD8      Status
</pre><pre class="literallayout">
<code class="function">KeepAlive</code>
     2     CARD16     version number (always 1)
     2     CARD16     opcode (always KeepAlive)
     2     CARD16     length (6)
     2     CARD16     Display Number
     4     CARD32     Session ID
</pre><pre class="literallayout">
<code class="function">Alive</code>
     2     CARD16     version number (always 1)
     2     CARD16     opcode (always Alive)
     2     CARD16     length (5)
     1     CARD8      Session Running (0: not running 1: running)
     4     CARD32     Session ID (0: not running)
</pre></div><div class="sect1" title="Display Class Format"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Display_Class_Format"></a>Display Class Format</h2></div></div></div><p>
The Display Class field of the
<code class="function">Manage</code>
packet is used by the display manager to collect common sorts of
displays into manageable groups.  This field is a string encoded of
ISO-LATIN-1 characters in the following format:
</p><pre class="literallayout">
<span class="emphasis"><em>ManufacturerID</em></span>-<span class="emphasis"><em>ModelNumber</em></span>
</pre><p>
Both elements of this string must exclude characters of the set
{ <code class="function">-</code>,
<code class="function">.</code>,
<code class="function">:</code>,
<code class="function">*</code>,
<code class="function">?</code>,
<span class="emphasis"><em>&lt;space&gt;</em></span> }.
The ManufacturerID is a string that should be registered
with the X Consortium.
The ModelNumber is designed to identify characteristics of the display
within the manufacturer's product line.
This string should be documented in the users manual for the
particular device and  should probably not be specifiable by the
display user to avoid unexpected configuration errors.
</p></div><div class="sect1" title="Manufacturer Display ID Format"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Manufacturer_Display_ID_Format"></a>Manufacturer Display ID Format</h2></div></div></div><p>
To authenticate the manager, the display and manager will share a private
key.
The manager, then, must be able to discover which key to use for a
particular device.
The Manufacturer Display ID field of the
<code class="function">Request</code>
packet is intended for this purpose.  Typically, the manager host will
contain a map between this number and the key.  This field is intended to be
unique per display, possibly the ethernet address of the display in the form:
</p><pre class="literallayout">
-Ethernet-8:0:2b:a:f:d2
</pre><p>
It can also be a string of the form:
</p><pre class="literallayout">
<span class="emphasis"><em>ManufacturerID</em></span>-<span class="emphasis"><em>ModelNumber</em></span>-<span class="emphasis"><em>SerialNumber</em></span>
</pre><p>
The ManufacturerID, ModelNumber and SerialNumber are encoded using
ISO-LATIN-1 characters, excluding {
<code class="function">-</code>,
<code class="function">.</code>,
<code class="function">*</code>,
<code class="function">?</code>,
<span class="emphasis"><em>&lt;space&gt;</em></span> }
</p><p>
When the display is shipped to a customer, it should include both the
Manufacturer Display ID and the private key in the documentation set.
This information should not be modifiable by the display user.
</p></div><div class="sect1" title="Authentication"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Authentication"></a>Authentication</h2></div></div></div><p>
In an environment where authentication is not needed, XDMCP can disable
authentication by having the display send empty Authentication Name
and Authentication Data fields in the
<code class="function">Request</code>
packet.
In this case, the manager will not attempt to authenticate itself.
Other authentication protocols may be developed, depending on local needs.
</p><p>
In an unsecure environment, the display must be able to verify that the
source of the various packets is a trusted manager.  These packets will
contain authentication information.  As an example of such a system, the
following discussion describes the "XDM-AUTHENTICATION-1" authentication
system.  This system uses a 56-bit shared private key, and 64 bits of
authentication data.  An associated example X authorization protocol
"XDM-AUTHORIZATION-1" will also be discussed.  The 56-bit key is represented
as a 64-bit number in network order (big endian).  This means that the first
octet in the representation will be zero.  When incrementing a 64-bit value,
the 8 octets of data will be interpreted in network order (big endian).
That is, the last octet will be incremented, subsequent carries propogate
towards the first octet.
</p><p>
Assumptions:
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
The display and manager share a private key.  This key could be programmed
into the display by the manufacturer and shipped with the unit.  It must not
be available from the display itself, but should allow the value to be
modified in some way.  The system administrator would be responsible for
managing a database of terminal keys.
    </p></li><li class="listitem"><p>
The display can generate random authentication numbers.
    </p></li></ol></div><p>
Some definitions first:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
{D}= encryption of plain text D by key κ
    </p></li><li class="listitem"><p>
{Δ}*κ = decryption of crypto text Δ with key κ
    </p></li><li class="listitem"><p>
τ = private key shared by display and manager
    </p></li><li class="listitem"><p>
ρ = 64 bit random number generated by display
    </p></li><li class="listitem"><p>
α = authentication data in XDMCP packets
    </p></li><li class="listitem"><p>
σ = per-session private key, generated by manager
    </p></li><li class="listitem"><p>
β = authorization data
    </p></li></ul></div><p>
Encryption will use the Data Encryption Standard (DES, FIPS 46-3); blocks
shorter than 64 bits will be zero-filled
on the right to 64 bits.  Blocks longer than 64 bits will use block chaining:
</p><p>
{D}κ = {D1 }κ {D2 xor {D1 }κ }κ
</p><p>
The display generates the first authentication data in the
<code class="function">Request</code>
packet:
</p><p>
αRequest = {ρ}τ

</p><p>
For the <code class="function">Accept</code>
packet, the manager decrypts the initial message and returns
αAccept:

</p><p>
ρ = {α Request } *τ
</p><p>
α Accept = { ρ + 1}τ
</p><p>
The <code class="function">Accept</code>
packet also contains the authorization intended for use by
the X server.  A description of authorization type "XDM-AUTHORIZATION-1"
follows.
</p><p>
The <code class="function">Accept</code>
packet contains the authorization name
"XDM-AUTHORIZATION-1".  The authorization data is the string:
</p><p>
β Accept = {σ}τ
</p><p>
To create authorization information for connection setup with the X server
using the XDM-AUTHORIZATION-1 authorization protocol, the client computes the
following:
</p><p>
N mark = "X client identifier"
</p><p>
T lineup = "Current time in seconds on client host (32 bits)"
</p><p>
β = {ρNT}σ
</p><p>
For TCP connections @N@ is 48 bits long and contains the 32-bit IPv4 address of
the client host followed by the 16-bit port number of the client socket.
Formats for other connections must be registered.
The resulting value, β, is 192 bits of authorization data that is sent
in the connection setup to the server.  The server receives the packet,
decrypts the contents.  To accept the connection, the following must hold:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
ρ must match the value generated for the most recent XDMCP negotiation.
    </p></li><li class="listitem"><p>
T must be within 1200 seconds of the internally stored time.  If no time
been received before, the current time is set to @T@.
    </p></li><li class="listitem"><p>
No packet containing the same pair (N, T) can have been received
in the last 1200 seconds (20 minutes).
    </p></li></ul></div></div></div></div></body></html>